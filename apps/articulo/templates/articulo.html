{% extends 'base.html' %}
{% block style %}
    <style type="text/css">
        .hidden {
            display: none !important;
        }
    </style>
{% endblock %}
{% block container %}
<form class="ui form">
    <h3 class="ui dividing header">Articulo</h3>
    <div class="row field">
        <label>Sku</label>
        <div class="ui icon input">
            <input id="sku" autofocus maxlength="6" type="text" name="sku" placeholder="Ingrese un sku">
            <i class="buscar circular search link icon"></i>
        </div>
    </div>
    <div class="row field">
        <label>Nombre</label>
        <div class="ui fluid input">
            <input id="nombre" maxlength="15" name="nombre" placeholder="Ingrese un nombre" type="text">
        </div>
    </div>
    <div class="two fields">
        <div class="row field">
            <label>Marca</label>
            <div class="ui fluid input">
                <input id="marca" name="marca" maxlength="15" placeholder="Ingrese una marca" type="text">
            </div>
        </div>
        <div class="row field">
            <label>Modelo</label>
            <div class="ui fluid input">
                <input id="modelo" name="modelo" maxlength="20" placeholder="Ingrese un modelo" type="text">
            </div>
        </div>
    </div>
    <div class="two fields">
        <div class="row field">
            <label>Cantidad</label>
            <div class="ui fluid input">
                <input id="cantidad" name="cantidad" type="number">
            </div>
        </div>
        <div class="row field">
            <label>Stock</label>
            <div class="ui fluid input">
                <input id="stock" name="stock" type="number">
            </div>
        </div>
    </div>
    <div class="row field">
        <label>Departamento</label>
        <select id="departamento" name="departamento" class="ui fluid dropdown">
            <option value="">State</option>
        </select>
    </div>
    <div class="row field">
        <label>Clase</label>
        <select id="clase" name="clase" class="ui fluid dropdown">
            <option value="">State</option>
        </select>
    </div>
    <div class="row field">
        <label>Familia</label>
        <select id="familia" name="familia" class="ui dropdown">
            <option value="">State</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
        </select>
    </div>
    <button id="agregar" type="button" class="ui green button hidden">Agregar</button>
    <button id="actualizar" type="button" class="ui green button hidden">Actualizar</button>
    <button id="eliminar" type="button" class="ui red button hidden">Eliminar</button>
    <div class="ui error message"></div>
</form>
{% endblock %}

{% block js %}
<script>
    window.articuloExist = false;

    $('select.dropdown').dropdown();
    const nombre = document.querySelector("#nombre");
    const marca = document.querySelector("#marca");
    const modelo = document.querySelector("#modelo");
    const cantidad = document.querySelector("#cantidad");
    const stock = document.querySelector("#stock");
    const departamento = document.querySelector("#departamento");
    const clase = document.querySelector("#clase");
    const familia = document.querySelector("#familia");
    const btnAgregar = document.querySelector("#agregar");
    const btnActualizar = document.querySelector("#actualizar");
    const btnEliminar = document.querySelector("#eliminar");


    
    const desabilitarInputs = () => {
        nombre.readOnly = true;
        nombre.parentElement.parentElement.classList.add("disabled");
        marca.readOnly = true;
        marca.parentElement.parentElement.classList.add("disabled");
        modelo.readOnly = true;
        modelo.parentElement.parentElement.classList.add("disabled");
        cantidad.readOnly = true;
        cantidad.parentElement.parentElement.classList.add("disabled");
        stock.readOnly = true;
        stock.parentElement.parentElement.classList.add("disabled");
        departamento.parentElement.parentElement.classList.add("disabled");
        clase.parentElement.parentElement.classList.add("disabled");
        familia.parentElement.parentElement.classList.add("disabled");
    }
    const habilitarInputs = () => {
        nombre.readOnly = false;
        nombre.parentElement.parentElement.classList.remove("disabled");
        marca.readOnly = false;
        marca.parentElement.parentElement.classList.remove("disabled");
        modelo.readOnly = false;
        modelo.parentElement.parentElement.classList.remove("disabled");
        cantidad.readOnly = false;
        cantidad.parentElement.parentElement.classList.remove("disabled");
        stock.readOnly = false;
        stock.parentElement.parentElement.classList.remove("disabled");
        departamento.parentElement.parentElement.classList.remove("disabled");
        clase.parentElement.parentElement.classList.remove("disabled");
        familia.parentElement.parentElement.classList.remove("disabled");
    }

    desabilitarInputs();
    
    $(".buscar").on("click", function (e) {
        if(articuloForm.element("#sku")) {
            if(articuloExist){
                habilitarInputs();
                btnActualizar.classList.remove("hidden");
                btnEliminar.classList.remove("hidden");
                btnAgregar.classList.add("hidden");
            }else{
                habilitarInputs();
                btnActualizar.classList.add("hidden");
                btnEliminar.classList.add("hidden");
                btnAgregar.classList.remove("hidden");
            }
        }
    });

    $("#agregar").on("click", function () {
        $(".ui.form").valid();
    });

    window.articuloForm = $(".ui.form")
    .validate({
        ignore:[],
        errorElement: "span",
        rules: {
            sku: {
                required: true,
                digits: true
            },
            nombre: {
                required: true,
            },
            marca: {
                required: true,
            },
            modelo: {
                required: true,
            },
            cantidad: {
                required: true,
                digits: true,
                maxlength: 9
            },
            stock: {
                required: true,
                digits: true,
                maxlength: 9
            },
            departamento: {
                required: true,
            },
            clase: {
                required: true,
            },
            familia: {
                required: true,
            }
        },
        messages: {
            sku: { 
                required: "Este campo es requerido",
                digits: "Sólo se aceptan dígitos"
            },
            nombre: {
                required: "Este campo es requerido"
            },
            marca: {
                required: "Este campo es requerido",
            },
            modelo: {
                required: "Este campo es requerido",
            },
            cantidad: {
                required: "Este campo es requerido",
                digits: "Sólo se aceptan dígitos",
                number: "Ingresa un numero valido",
                maxlength: "Maximo 9 digitos"
            },
            stock: {
                required: "Este campo es requerido",
                digits: "Sólo se aceptan dígitos",
                number: "Ingresa un numero valido",
                maxlength: "Maximo 9 digitos"
            },
            departamento: {
                required: "Seleccione una opción"
            },
            clase: {
                required: "Seleccione una opción"
            },
            familia: {
                required: "Seleccione una opción"
            },
        },
        errorPlacement: function (error, element) {
            error.addClass("ui basic red pointing prompt label transition");
            error.insertAfter(element.parent());
        },
        highlight: function (element, errorClass, validClass) {
            $(element).parents(".row").addClass(errorClass);
        },
        unhighlight: function (element, errorClass, validClass) {
            $(element).parents(".row").removeClass(errorClass);
        }
    });
</script>
{% endblock %}